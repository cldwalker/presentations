<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>AWS Elasticache</title>
<!-- 2014-06-04 Wed 09:07 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Gabriel Horner" />
<link rel="stylesheet" type="text/css" href="common.css" />
<link rel="stylesheet" type="text/css" href="screen.css" media="screen" />
<link rel="stylesheet" type="text/css" href="projection.css" media="projection" />
<link rel="stylesheet" type="text/css" href="presenter.css" media="presenter" />
</head>
<body>
<div id="content">
<h1 class="title">AWS Elasticache</h1>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">AWS ElastiCache Briefing&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h2>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Choosing to use&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">What is it?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>Amazon ElastiCache is a web service that provides an
in-memory cache for your AWS application.
</li>
<li>This cache is a scalable cluster of Memcached or Redis protocol-compliant
server nodes.
</li>
<li>This service has a number of features to streamline the
management, monitoring and operation of these nodes.
</li>
</ul>
</div>
<div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-2-1-1">
<ul class="org-ul">
<li>Amazon ElastiCache is protocol-compliant with Memcached and Redis,
so applications that already use another existing Memcached or Redis
environment can work seamlessly with this service
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">What problems does ElastiCache strive to solve?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-2">
<p>
TODO
</p>
<ul class="org-ul">
<li>Problem 1: Building a caching cluster requires
provisioning a server, installing caching software and knowledge of
how to setup a cluster.
</li>
<li>Problem 2: Operating a caching cluster requires configuring it,
understanding and mitigating its failure modes, updating software,
backups (if possible) and more.
</li>
<li>Problem 3: Monitoring a caching cluster requires gathering a cluster's
metrics and having a useful way of interpreting them.
</li>
<li>Problem 4: Automate all of the above to make a scalable, elastic
and fault-tolerant cluster.
</li>
</ul>
</div>
<div id="outline-container-sec-2-2-1" class="outline-4">
<h4 id="sec-2-2-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-2-2-1">
<ul class="org-ul">
<li>p2: backups only for redis
</li>
<li>p2: configuring it is not a solved problem but hopefully one that
starts out with more desirable defaults
</li>
<li>p3: i.e. a visual way perhaps a dashboard
</li>
<li>p3: you also need to understand how to take action on those metrics
</li>
<li>p4: fault-tolerant here means being able to lose a node and have one
automatically take its place.
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Fundamental semantics</h3>
<div class="outline-text-3" id="text-2-3">
</div><div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1">What is it 'about'?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h4>
<div class="outline-text-4" id="text-2-3-1">
<div style="text-align: center; font-size: 150%;">Caching!</div>


<div class="figure">
<p><img src="img/basic_elasticache_architecture.png" alt="basic_elasticache_architecture.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-3-2" class="outline-4">
<h4 id="sec-2-3-2">What is it 'about'? (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
ElastiCache aims to reduce read load on your database, web server, or
anything that can benefit from caching.
</p>

<p>
It's about setting up and operating a cache cluster in the cloud with
minimal effort.
</p>

<p>
It's about observing how your cache is performing to improve it.
</p>
</div>
</div>
<div id="outline-container-sec-2-3-3" class="outline-4">
<h4 id="sec-2-3-3">What are the primary operations?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h4>
<div class="outline-text-4" id="text-2-3-3">
<ul class="org-ul">
<li>Create, edit, reboot and delete cache clusters
</li>
<li>Create, edit, promote and delete Redis replication groups
</li>
<li>Create, edit, list and reset cache parameter groups
</li>
<li>Create, edit, assign/authorize and delete cache security groups and subnet groups
</li>
<li>Create, show, copy, delete and restore Redis snapshots
</li>
</ul>
</div>
<div id="outline-container-sec-2-3-3-1" class="outline-5">
<h5 id="sec-2-3-3-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h5>
<div class="outline-text-5" id="text-2-3-3-1">
<p>
Don't read or explain em all
There's 34 actions in all
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-3-4" class="outline-4">
<h4 id="sec-2-3-4">Is it simple?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h4>
<div class="outline-text-4" id="text-2-3-4">
<p>
Theoretically yes - it's just a FewClicksâ„¢ caching but &#x2026;
</p>
<ul class="org-ul">
<li>Different node types can impact throughput, latency.
</li>
<li>Different configurations can impact reliability, durability, elasticity.
</li>
<li>Conceptually grouping Redis and Memcached works until it doesn't.
</li>
</ul>

<p>
So <i>NO</i>
</p>
</div>
<div id="outline-container-sec-2-3-4-1" class="outline-5">
<h5 id="sec-2-3-4-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h5>
<div class="outline-text-5" id="text-2-3-4-1">
<p>
TODO
</p>
<ul class="org-ul">
<li>many actions
</li>
<li>configuration, node types and redis/memcached disconnect can make it hard to reason about
</li>
<li>redis and memcached have different concepts and features
</li>
<li>redis has replication and backup. memcached has auto-discovery.
</li>
<li>redis can be durable
</li>
<li>Grouping the two can be confusing as one concept may not apply to
another i.e. replication and some limits don't apply to others i.e.
node limit per cluster
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">Architectural overview</h3>
<div class="outline-text-3" id="text-2-4">
</div><div id="outline-container-sec-2-4-1" class="outline-4">
<h4 id="sec-2-4-1">Key components&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h4>
<div class="outline-text-4" id="text-2-4-1">
<ul class="org-ul">
<li>engine: Redis or Memcached
</li>
<li>node: Smallest building block with its own DNS name and port
</li>
<li>cluster: Group of nodes with the same engine type
</li>
</ul>
</div>
<div id="outline-container-sec-2-4-1-1" class="outline-5">
<h5 id="sec-2-4-1-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h5>
<div class="outline-text-5" id="text-2-4-1-1">
<ul class="org-ul">
<li>node runs an instance of memcached/redis
</li>
<li>redis only has one node per cluster 
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-4-2" class="outline-4">
<h4 id="sec-2-4-2">Key components (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h4>
<div class="outline-text-4" id="text-2-4-2">

<div class="figure">
<p><img src="img/cluster_diagrams.png" alt="cluster_diagrams.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-4-3" class="outline-4">
<h4 id="sec-2-4-3">Key components (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h4>
<div class="outline-text-4" id="text-2-4-3">
<ul class="org-ul">
<li>cache parameter group: Group of parameters to be associated with a
cluster
</li>
<li>cache security group: Controls network access to public cluster
</li>
<li>cache subnet group: Controls network access to private cluster
</li>
<li>Redis replication group: One primary/write cluster and up to five
read clusters
</li>
</ul>
</div>
<div id="outline-container-sec-2-4-3-1" class="outline-5">
<h5 id="sec-2-4-3-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h5>
<div class="outline-text-5" id="text-2-4-3-1">
<ul class="org-ul">
<li>Think of replication group as cluster group
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-4-4" class="outline-4">
<h4 id="sec-2-4-4">Key components (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h4>
<div class="outline-text-4" id="text-2-4-4">

<div class="figure">
<p><img src="img/elasticache_components.png" alt="elasticache_components.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-4-5" class="outline-4">
<h4 id="sec-2-4-5">Key features/functions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h4>
<div class="outline-text-4" id="text-2-4-5">
<ul class="org-ul">
<li>Provision and operation of clusters of Memcached/Redis nodes
</li>
<li>Detailed monitoring statistics of nodes via Cloudwatch
</li>
<li>Failed nodes are automatically detected and replaced
</li>
<li>Auto discovery of Memcached nodes
</li>
</ul>
</div>
<div id="outline-container-sec-2-4-5-1" class="outline-5">
<h5 id="sec-2-4-5-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h5>
<div class="outline-text-5" id="text-2-4-5-1">
<ul class="org-ul">
<li>Auto-discovery works by having an endpoint which is in charge of
registering nodes
</li>
<li>Auto-discovery requires an additional client for this functionality.
Amazon supports Java and PHP by default.
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-4-6" class="outline-4">
<h4 id="sec-2-4-6">Key features/functions (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h4>
<div class="outline-text-4" id="text-2-4-6">
<ul class="org-ul">
<li>Backup and restore including automated daily snapshots
</li>
<li>Replication groups for Redis
</li>
<li>Full integration with VPC
</li>
<li>Accessible from AWS Console, API or CLI
</li>
</ul>
</div>
<div id="outline-container-sec-2-4-6-1" class="outline-5">
<h5 id="sec-2-4-6-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h5>
<div class="outline-text-5" id="text-2-4-6-1">
<ul class="org-ul">
<li>Backups are made to s3. Backups can be done manually or automatic.
Snapshot mechanism can be used to migrate a Redis cache to ElastiCache
</li>
<li>Redis replication - ability to replace primary within a group
</li>
<li>Redis replication group has no client and requires using API
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5">Key indicators for use&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-5">
<ul class="org-ul">
<li>Your app, db or caching target is on AWS
</li>
<li>You want to use Redis or Memcached
</li>
<li>Your cache needs are large enough to require a caching cluster i.e.
in the GB range
</li>
</ul>
</div>
<div id="outline-container-sec-2-5-1" class="outline-4">
<h4 id="sec-2-5-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-2-5-1">
<ul class="org-ul">
<li>Cache sizes go from standard small (1.3GB) to enhanced xxlarge (29GB)
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6">Key indicators against use&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-6">
<ul class="org-ul">
<li>Inverse of the indicators for use
</li>
<li>Have differing opinions on Redis and backups or security
</li>
<li>You want to use unsupported versions of Redis or Memcached
</li>
</ul>
</div>
<div id="outline-container-sec-2-6-1" class="outline-4">
<h4 id="sec-2-6-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-2-6-1">
<p>
ElastiCache handles the above Redis topics for you so it's only a
problem if your opinions differ.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7">Fundamental tradeoffs&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-7">
<p>
You get:
</p>
<ul class="org-ul">
<li>Managed: Provisioning, management and even patch updating are
automated
</li>
<li>Compatible: Native access to Memached or Redis
</li>
<li>Scalability: Easily add and remove nodes
</li>
<li>Reliability: Automatic failure detection and recovery
</li>
<li>Great integration with AWS: metrics, security, notifications
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-8" class="outline-3">
<h3 id="sec-2-8">Fundamental tradeoffs (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-8">
<p>
You give up:
</p>

<ul class="org-ul">
<li>Being anywhere but AWS
</li>
<li>Fine grained control of node failure recovery
</li>
<li>Fine-grained control of Redis backups, slaves of slaves in
replication groups and having more than 5 slaves in a replication
group.
</li>
<li><a href="http://docs.aws.amazon.com/AmazonElastiCache/latest/UserGuide/ClientConfig.html#ClientConfig.RestrictedCommands">Certain Redis commands</a>
</li>
<li>Preferred tooling for metrics and notifications around your caching
engine.
</li>
<li>Unsupported versions of Redis or Memcached
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-9" class="outline-3">
<h3 id="sec-2-9">Alternatives&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-9">
<ul class="org-ul">
<li><a href="http://redislabs.com/">RedisLabs</a>
<ul class="org-ul">
<li>Memcached and Redis services
</li>
<li>Scalability is defined by just memory size. No nodes,
clusters or engine-specific configuration.
</li>
<li>Different pricing tiers for more features i.e. replication, multiple
A-Z, backups
</li>
<li>Available on AWS, Azure, SoftLayer and GCE
</li>
<li>Backups and imports: any of the previous environments or to an ftp
server
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-10" class="outline-3">
<h3 id="sec-2-10">Alternatives (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-10">
<ul class="org-ul">
<li><a href="https://www.memcachier.com/">Memcachier</a> - Memcached only. Similar to RedisLabs in simplicity.
</li>
<li>Redis only
<ul class="org-ul">
<li><a href="http://redistogo.com/">Redis to Go</a> - Limiting plans and features. Poor documentation.
Early Heroku addon
</li>
<li><a href="http://www.redisgreen.net/">RedisGreen</a> - Simple but with more features - provides dedicated
machines, hourly backups and metrics dashboard
</li>
<li><a href="http://azure.microsoft.com/en-us/services/cache/">Microsoft Azure Redis Cache</a> - Redis features somewhere between
RedisLabs and ElastiCache
</li>
</ul>
</li>
</ul>

<p>
Recommendation: RedisLabs and Azure Redis Cache are worth investigating.
</p>
</div>
</div>
<div id="outline-container-sec-2-11" class="outline-3">
<h3 id="sec-2-11">Application characteristics&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-11">
<ul class="org-ul">
<li>Environment: Hosted on AWS
</li>
<li>Docs: Excellent, like most AWS documentation
</li>
<li>API quality:
<ul class="org-ul">
<li>Well done for a non-trivial API.
</li>
<li>Each operation and its parameters <a href="http://docs.aws.amazon.com/AmazonElastiCache/latest/APIReference/Welcome.html">are documented</a>.
</li>
<li>API versioning done by release date.
</li>
<li>Standard SDKs: java, .NET, ruby, php, python
</li>
</ul>
</li>
<li>Dependencies: Redis or Memcached and AWS infrastructure i.e. EC2, S3, CloudWatch
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-12" class="outline-3">
<h3 id="sec-2-12">Application characteristics (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-12">
<ul class="org-ul">
<li>Community: Not much but enough for production concerns
<ul class="org-ul">
<li><a href="https://forums.aws.amazon.com/forum.jspa?forumID=127">Support Forum</a> - Actively monitored by Amazon employees
</li>
<li>Not much in the wild: few results on GitHub, presentations mainly
by Amazon.
</li>
</ul>
</li>
<li>Longevity
<ul class="org-ul">
<li>Started with Memcached in 2011 and Redis since 9/2013.
</li>
<li>Marked as Beta
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-13" class="outline-3">
<h3 id="sec-2-13">Application characteristics (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-13">
<ul class="org-ul">
<li>Experience reports
<ul class="org-ul">
<li><a href="http://aws.amazon.com/solutions/case-studies/placeiq/">PlaceIQ</a>
<ul class="org-ul">
<li>Used ElastiCache Memcached to cache requests to Nginx
</li>
<li>End-to-end response times improved 83% and resulted in net
savings
</li>
</ul>
</li>
<li><a href="http://aws.amazon.com/solutions/case-studies/health-guru/">Health Guru</a>
<ul class="org-ul">
<li>Used ElastiCache Memcached to cache partial pages, pages and
client-side widgets
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-2-13-1" class="outline-4">
<h4 id="sec-2-13-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-2-13-1">
<ul class="org-ul">
<li><a href="http://aws.amazon.com/solutions/case-studies/placeiq/">PlaceIQ</a>
<ul class="org-ul">
<li>Used ElastiCache Memcached to cache requests to Nginx
</li>
<li>End-to-end response times improved 83% and resulted in net
savings
</li>
</ul>
</li>
<li><a href="http://aws.amazon.com/solutions/case-studies/health-guru/">Health Guru</a>
<ul class="org-ul">
<li>Used ElastiCache Memcached to cache partial pages, pages and
client-side widgets
</li>
<li>Team was able to implement a solution in less than a week, saves
the team 20 hours a week and resulted in 92% improvement in response times
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-14" class="outline-3">
<h3 id="sec-2-14">Operational characteristics&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-14">
<ul class="org-ul">
<li>Latency
<ul class="org-ul">
<li>Low latency to other Availability Zones (AZ) in the same region
</li>
<li>According to <a href="http://blog.meldium.com/home/2013/9/13/benchmarking-redis-on-aws-elasticache">this post</a>, 99th percentile latency from a Redis node to an EC2
instance was in single digit milliseconds except for the micro and
small types which were orders of magnitude more.
</li>
</ul>
</li>
<li>Throughput
<ul class="org-ul">
<li>Caches are designed to provide high throughput.
</li>
<li>Blog post used redis-benchmark and found throughput ranging from 10k to 70k ops per
second, depending on node type.
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-2-14-1" class="outline-4">
<h4 id="sec-2-14-1">notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-2-14-1">
<ul class="org-ul">
<li>Amazon describes latency across their services with low, medium and
high.
</li>
<li>Without knowing if this company is properly benchmarking on EC2, only
treat numbers as rough orders of magnitude
</li>
<li>As long as its a cache hit, throughput can be high
</li>
<li>redis-benchmark comes with Redis and allows you to specify which
commands to run.
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-15" class="outline-3">
<h3 id="sec-2-15">Operational characteristics (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-15">
<ul class="org-ul">
<li>Throughput (cont)
<ul class="org-ul">
<li>Diminishing returns on throughput for largest Redis nodes. This is
because Redis is single-threaded and in the largest 
instances you're mostly paying for more unused cores.
</li>
</ul>
</li>
</ul>


<div class="figure">
<p><img src="img/redis_benchmarks.png" alt="redis_benchmarks.png" />
</p>
</div>
</div>
<div id="outline-container-sec-2-15-1" class="outline-4">
<h4 id="sec-2-15-1">notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-2-15-1">
<ul class="org-ul">
<li>mid-range nodes offer higher ECUs - EC2 Computing Units
</li>
<li>Yes, I've only talked about Redis. Found no numbers on Memcached but
since it's multi-threaded it should do better with larger nodeOBs.
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-16" class="outline-3">
<h3 id="sec-2-16">Operational characteristics (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-16">
<ul class="org-ul">
<li>Scalability
<ul class="org-ul">
<li>Writes scale out for Memcached - 20 node limit and then manually request
</li>
<li>Writes do not scale out for Redis - one node limit per cluster
</li>
<li>Reads scale out only for Redis - 5 node limit per cluster
</li>
<li>Both write and read nodes scale up but require new clusters
</li>
<li><a href="http://redislabs.com/blog/the-endless-redis-replication-loop-what-why-and-how-to-solve-it">There may be demons</a> with scaling up Redis replication, Redis 2.6.X and &gt; 25GB
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-17" class="outline-3">
<h3 id="sec-2-17">Operational characteristics (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-17">
<ul class="org-ul">
<li>Elasticity
<ul class="org-ul">
<li>Adding and removing nodes is elastic - takes a few minutes
</li>
<li>Scaling up is not elastic - must upgrade <i>whole</i> cluster
<ul class="org-ul">
<li>Requires new cluster setup i.e. configuring security
</li>
<li>Requires restoring from a backup or recaching.
</li>
</ul>
</li>
<li>Node failure detection and recovery is automated elasticity
</li>
<li>Scaling is not automated
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-2-17-1" class="outline-4">
<h4 id="sec-2-17-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-2-17-1">
<ul class="org-ul">
<li>Takes a few minutes assuming you're configured correctly
</li>
<li>Clients poll every minute for auto discovery
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-18" class="outline-3">
<h3 id="sec-2-18">Operational characteristics (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-18">
<ul class="org-ul">
<li>Security
<ul class="org-ul">
<li>By default network access is turned off to your cluster
</li>
<li>To allow access to a public cluster, create a security group and associate it with an
EC2 security group
</li>
</ul>
</li>
</ul>


<div class="figure">
<p><img src="img/datomic_security_group.png" alt="datomic_security_group.png" />
</p>
</div>
</div>

<div id="outline-container-sec-2-18-1" class="outline-4">
<h4 id="sec-2-18-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-2-18-1">
<ul class="org-ul">
<li>"IP-range based access control is currently not enabled for Cache
Clusters"
</li>
<li>"Currently, all clients to an ElastiCache Cluster must be within the
Amazon EC2 network" - You can always hope
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-19" class="outline-3">
<h3 id="sec-2-19">Operational characteristics (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-19">
<p>
TODO
</p>
<ul class="org-ul">
<li>Security
<ul class="org-ul">
<li>Supports private clusters within a Virtual Private Cloud (VPC). This requires:
<ul class="org-ul">
<li>A VPC with at least one subnet
</li>
<li>A Cache Subnet Group for your VPC to associate with previous subnet
</li>
<li>Allocating enough CIDR blocks to your subnet to allow for spare
IPS needed for cache node replacement
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2-20" class="outline-3">
<h3 id="sec-2-20">Operational characteristics (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-20">
<ul class="org-ul">
<li>Failure Modes
<ul class="org-ul">
<li>Region fails - that's a problem
</li>
<li>AZ fails - you can mitigate this
</li>
<li>Cache node fails - automatically detected and replaced
</li>
<li>Redis primary fails - Can result in write downtime for 3-6 min. If
primary fails to heal, manually promote a read
</li>
<li>Cache node reboots
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-2-20-1" class="outline-4">
<h4 id="sec-2-20-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-2-20-1">
<ul class="org-ul">
<li>Could explain how cache node failures work
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-2-21" class="outline-3">
<h3 id="sec-2-21">What does it cost?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-2-21">
<ul class="org-ul">
<li>Billing is per hour per node ($0.022 to $1.207).
</li>
<li>Reserved Cache Nodes
<ul class="org-ul">
<li>Pay up front for 1 or 3 years.
</li>
<li>Three tiers - the more you pay upfront, the less you pay per hour.
</li>
</ul>
</li>
<li>Data transfer: Only charge is on EC2 instance to another AZ - <i>only</i>
  on the EC2 end.
</li>
<li>Backup: Storage is $0.085/GB every month. Data transfer is no charge.
</li>
<li>For more, see <a href="https://aws.amazon.com/elasticache/pricing/">pricing page</a>
</li>
</ul>
</div>
<div id="outline-container-sec-2-21-1" class="outline-4">
<h4 id="sec-2-21-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-2-21-1">
<ul class="org-ul">
<li>Partial hours get rounded up.
</li>
<li>Billing starts when node is in 'Available' state.
</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">In Use&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">What are the critical decisions?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-3-1">
<ul class="org-ul">
<li>Which caching engine do I choose?
</li>
<li>Which node type should I choose?
</li>
<li>How do I mitigate failure modes?
</li>
<li>How do I handle upgrades? - <a href="http://docs.aws.amazon.com/AmazonElastiCache/latest/UserGuide/VersionManagement.html">See Docs</a>
</li>
<li>What Cache Parameters should I be aware of?
</li>
<li>How should I persist with Redis?
</li>
<li>Which metrics should I monitor? - <a href="http://docs.aws.amazon.com/AmazonElastiCache/latest/UserGuide/CacheMetrics.WhichShouldIMonitor.html">See Docs</a>
</li>
</ul>
</div>
<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-3-1-1">
<ul class="org-ul">
<li>How do I handle upgrades? Auto upgrading patch versions are enabled
by default. See Docs for more
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Which caching engine do I choose?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li>Memcached
<ul class="org-ul">
<li>Pro: Multi-threaded
</li>
<li>Pro: Low complexity
</li>
<li>Pro: Wide adoption - some databases may only be memcached
compliant, easy to configure
</li>
<li>Con: Max value is 1MB
</li>
<li>Con: No persistence
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-3-2-1">
<ul class="org-ul">
<li>low complexity: just a key/val store, can know all commands quickly
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">Which caching engine do I choose? (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li>Redis
<ul class="org-ul">
<li>Pro: Powerful data types and commands to leverage them
</li>
<li>Pro: Max value is 512MB
</li>
<li>Pro: Persistence, Lua scripting, pub/sub and more
</li>
<li>Pro: Replication - allows for data across multiple AZs
</li>
<li>Cons: Single-threaded and more complex
</li>
</ul>
</li>
</ul>

<p>
Recommendation: Use Memcached until you need a Redis data type or
another feature i.e. multiple AZs.
</p>
</div>
<div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-3-3-1">
<ul class="org-ul">
<li>Data types: Sorted sets for time-series, hashes for sessions, lists
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4">Which node type should I choose?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-3-4">
<ul class="org-ul">
<li>Factor cost - per system characteristic if possible
</li>
<li>Factor total memory
<ul class="org-ul">
<li>Easy to scale out with Memcached.
</li>
<li>Must choose more accurately with Redis.
</li>
</ul>
</li>
<li>Factor throughput - More ECUs and cores on larger boxes
</li>
<li>Factory latency - double check but most likely avoid micro and
small
</li>
<li>Recommendation: Depends on above. Avoid micro on production
</li>
</ul>
</div>
<div id="outline-container-sec-3-4-1" class="outline-4">
<h4 id="sec-3-4-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-3-4-1">
<ul class="org-ul">
<li>cost - consider ops/$
</li>
<li>memory ranges from .2GB to 68GB
</li>
<li>throughput - be aware of Redis single-thread and largest boxes
</li>
<li>Amazon suggests starting out small on Memcached and monitoring
memory, cpu and hit rate
</li>
<li>micro doesn't have AOF or snapshot or &#x2026;
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3-5" class="outline-3">
<h3 id="sec-3-5">How do I mitigate failure modes?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-3-5">
<ul class="org-ul">
<li>AZ failure - Have nodes in multiple AZs.
<ul class="org-ul">
<li>Only possible out of the box with Redis replication groups
</li>
</ul>
</li>
<li>Node failure - Keep your cache hit rate up
<ul class="org-ul">
<li>Memcached
<ul class="org-ul">
<li>Docs recommend being able to handle one or 2 nodes failing
</li>
<li>For example, for a 14GB requirement, better to have 2 7GB nodes
than one 14 GB
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-3-5-1" class="outline-4">
<h4 id="sec-3-5-1">notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-3-5-1">
<ul class="org-ul">
<li>Possible to handle AZ failure in Memcached but requires doing this
in the app layer and increasing the number of writes to redundant
nodes
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3-6" class="outline-3">
<h3 id="sec-3-6">How do I mitigate failure modes? (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-3-6">
<ul class="org-ul">
<li>Node failure (cont)
<ul class="org-ul">
<li>Redis
<ul class="org-ul">
<li>Use replication groups for minimal cache loss
</li>
<li>Manual or daily snapshots but with caveats
</li>
</ul>
</li>
</ul>
</li>
<li>Node reboots
<ul class="org-ul">
<li>Memcached: Nada
</li>
<li>Redis: Turn on Append-Only Files (AOF) for reboot failure
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-3-6-1" class="outline-4">
<h4 id="sec-3-6-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-3-6-1">
<ul class="org-ul">
<li>snapshots can have a performance impact spawning child process which
can block parent for up to 10s
</li>
<li>AOF works by replaying file on bootup which results in restored
cache
</li>
<li>reboots need to happen for configs to set in
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-3-7" class="outline-3">
<h3 id="sec-3-7">What Cache Parameters should I be aware of?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-3-7">
<ul class="org-ul">
<li>Memcached has over a dozen and Redis has 30+
</li>
<li>Memcached - memcached_connections_overhead
<ul class="org-ul">
<li>Total memory = Usable memory + Connection memory
</li>
<li>Default is 100 MB on non-micro instances
</li>
<li>Increase when observing swap usage and degraded performance
</li>
<li>Decrease if you want more memory to use
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-8" class="outline-3">
<h3 id="sec-3-8">What Cache Parameters should I be aware of? (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-3-8">
<ul class="org-ul">
<li>Redis
<ul class="org-ul">
<li>reserved-memory
<ul class="org-ul">
<li>Total memory = Usable memory + reserved memory
</li>
<li>Default is 0
</li>
<li>Consider increase if using replication, AOFs or snapshots
</li>
</ul>
</li>
<li>appendonly: enables AOF
</li>
<li>appendfsync: Controls how often AOF writes to disk
</li>
</ul>
</li>
</ul>
</div>

<div id="outline-container-sec-3-8-1" class="outline-4">
<h4 id="sec-3-8-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-3-8-1">
<p>
If no memory for non-redis tasks, this can lead to memory paging
</p>
</div>
</div>
</div>
<div id="outline-container-sec-3-9" class="outline-3">
<h3 id="sec-3-9">How should I persist with Redis?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-3-9">
<ul class="org-ul">
<li>AOF
<ul class="org-ul">
<li>Pro: Just a config switch away
</li>
<li>Pro: No financial cost
</li>
<li>Con: Guards against reboot and nothing else
</li>
</ul>
</li>
<li>Backups
<ul class="org-ul">
<li>Pro: Daily automated snapshots
</li>
<li>Pro: Manual snapshots + API allow for custom intervals
</li>
<li>Con: Can have performance impact
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-3-10" class="outline-3">
<h3 id="sec-3-10">How should I persist with Redis? (cont)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-3-10">
<ul class="org-ul">
<li>Backups (cont)
<ul class="org-ul">
<li>Con: Costs to store data
</li>
</ul>
</li>
<li>Persistance Groups
<ul class="org-ul">
<li>Pro: Read nodes are tightly in sync with primary
</li>
<li>Pro: Can scale reads out
</li>
<li>Pro: Can handle write failover with almost no cache loss
</li>
<li>Con: Incur cost of new nodes
</li>
</ul>
</li>
</ul>
</div>
<div id="outline-container-sec-3-10-1" class="outline-4">
<h4 id="sec-3-10-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-3-10-1">
<p>
Recommendation: Choose based on system needs and cost. All of em if
you can
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Summary&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">Questions&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li>Is there auto scaling for ElastiCache?
<ul class="org-ul">
<li>No but it's <a href="https://github.com/neevtechnologies/aws_elasticache_autoscale">possible with their API</a>
</li>
</ul>
</li>
<li>How difficult is it to run and maintain a Redis Replication group?
</li>
<li>What AWS services can use ElastiCache and which engine can they use? 
<ul class="org-ul">
<li>Beanstalk, process in EC2, RDS and more
</li>
</ul>
</li>
<li>Are there overlapping use cases for the Redis engine and DynamoDB?
</li>
</ul>
</div>
<div id="outline-container-sec-4-1-1" class="outline-4">
<h4 id="sec-4-1-1">Notes&#xa0;&#xa0;&#xa0;<span class="tag"><span class="notes">notes</span></span></h4>
<div class="outline-text-4" id="text-4-1-1">
<ul class="org-ul">
<li>Script works by adding and removing nodes based on average memory thresholds
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">Essential Resources&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-4-2">
<ul class="org-ul">
<li><a href="http://aws.amazon.com/documentation/elasticache/">Documentation</a> - User Guide, CLI and API
</li>
<li><a href="https://www.youtube.com/channel/UCd6MoB9NC6uYN2grvUNT-Zg">Presentations</a>
</li>
<li><a href="http://www.slideshare.net/AmazonWebServices">Slides</a>
</li>
<li><a href="http://aws.typepad.com/aws/amazon-elasticache/">AWS Blog</a> - Posts tagged with ElastiCache
</li>
<li><a href="http://aws.amazon.com/elasticache/developer-resources/">More Resources</a> - FAQ and Release Notes
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3">What's next?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-4-3">
<ul class="org-ul">
<li>ElastiCache future looks bright
<ul class="org-ul">
<li>Redis support released last September
</li>
<li>Major features like backup and restore were released end of April
</li>
<li>Eventual Redis 3 support?
</li>
</ul>
</li>
<li>Competitors
<ul class="org-ul">
<li>Will RedisLabs become more ElastiCache or vice versa?
</li>
<li>Will Azure Redis keep up with ElastiCache?
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4">Recommendations for/against use?&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-4-4">
<ul class="org-ul">
<li>If you're on AWS
<ul class="org-ul">
<li>And need caching at the GB scale with Memcached or Redis
</li>
<li>And want the OPS handled for you
</li>
<li>Then Yes
</li>
</ul>
</li>
<li>Beware of unexpected limits, unavailable Redis features and know
your configuration
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-4-5" class="outline-3">
<h3 id="sec-4-5">Final thoughts&#xa0;&#xa0;&#xa0;<span class="tag"><span class="slide">slide</span></span></h3>
<div class="outline-text-3" id="text-4-5">
<ul class="org-ul">
<li>What else should we know?
<ul class="org-ul">
<li>I'm happy to answer questions afterwards.
</li>
<li>There's more to caching software than just Redis or Memcached.
</li>
</ul>
</li>
<li>What do you wish was different or better?
<ul class="org-ul">
<li>Wish ElastiCache was easier to reason about, had less failure
modes and had automated elasticity
</li>
<li>Also wish for scaling up with no downtime
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">END</h2>
<div class="outline-text-2" id="text-5">
<script type="text/javascript" src="org-html-slideshow.js"></script>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Gabriel Horner</p>
<p class="date">Created: 2014-06-04 Wed 09:07</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.2.1 (<a href="http://orgmode.org">Org</a> mode 8.2.6)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
